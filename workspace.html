<!--
var url = 'https://free.currencyconverterapi.com/api/v5/currencies';
       fetch(url)
       .then(function(response) {
         return response.json();
       })
       .then(function(data) {
         var myobj = data.results
         for(key in myobj){
           console.log(myobj[key]['id']);
         }
         
       })
       .catch(function(error) {
         log('Request failed', error)
       });-->

const db = open.result,
    tx = db.transaction("MyObjectStore", "readwrite"),
    store = tx.objectStore("MyObjectStore"),
    index = store.index("NameIndex");
    $.ajax({
       url: 'https://free.currencyconverterapi.com/api/v5/currencies',
       type: 'GET',
       dataType: "JSON",
       success: (data)=>{console.log(data);store.put(data)}
   });

 $(".cur").append(`<option value="${results[result][c_id]["id"]}">${results[result][c_id]["currencySymbol"]} - ${results[result][c_id]["currencyName"]}</option>`); 

function convertCurrency(){
 let from            =   document.getElementsByClassName("currencies_1").value;
 let to              =   document.getElementsByClassName("currencies_2").value;
 let fromAmount      =   document.getElementById("fromAmount").value;
 let toAmount        =   document.getElementById("toAmount");
 let query           =   `${from}_${to},${to}_${from}`;
 // var url          = "https://free.currencyconverterapi.com/api/v5/convert?q=${fromQuery},${toQuery}&compact=ultra";
 fetch(`https://free.currencyconverterapi.com/api/v5/convert?q=${query}&compact=y`).then(function(response) {
    return response.json();
    }).then(function(myjson) {
       let calc = myjson[query].results.val;
       var total = Math.round(calc * fromAmount * 100) / 100;
       console.log(total);
       toAmount.value = total;
       // toAmount.innerHTML = "1.00";
    }).catch(err =>{
   console.log(JSON.stringify(err));
 });
}

// register service worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
        navigator.serviceWorker.register('scripts/sw.js').then(function (registration) {
            console.log('Service worker successfully registered on scope', registration.scope);
        }).catch(function (error) {
            console.log('Service worker failed to register');
        });
    });
}




const currencyUrl = "https://free.currencyconverterapi.com/api/v5/currencies";

fetch(currencyUrl)
.then(function(res){
	return res.json();
})
.then(function(data){
	for (var key in data) {
	  return data[key];
	}
	//console.log(data);
})
.then(function(datakey){
	for (const key2 in datakey) {
		const id = datakey[key2].id;
		$('#convertfrom, #convertto').append($('<option>').text(id).attr('value', id));
	}
})
.catch(function(error){
	console.log(error);
})

const convertCurrency = () => 
{
	const convertfrom = document.getElementById("convertfrom").value;
	const convertto = document.getElementById("convertto").value;
	const query = convertfrom + '_' + convertto;
	const url = "https://free.currencyconverterapi.com/api/v5/convert?q="+ query + "&compact=ultra";

	fetch(url)
		.then(response => {
			return response.json();
		}).then(data => {
			const oneUnit = data[query];
			const amt = document.getElementById("fromAmount").value;
			document.getElementById("amountConverted").value = (oneUnit*amt).toFixed(2);
			
		})
}

            
            
var https = require('https');

function convertCurrency(amount, fromCurrency, toCurrency, cb) {
  var apiKey = 'your-api-key-here';

  fromCurrency = encodeURIComponent(fromCurrency);
  toCurrency = encodeURIComponent(toCurrency);
  var query = fromCurrency + '_' + toCurrency;

  var url = 'https://www.currencyconverterapi.com/api/v5/convert?q='
            + query + '&compact=ultra&apiKey=' + apiKey;

  https.get(url, function(res){
      var body = '';

      res.on('data', function(chunk){
          body += chunk;
      });

      res.on('end', function(){
          try {
            var jsonObj = JSON.parse(body);

            var val = jsonObj[query];
            if (val) {
              var total = val * amount;
              cb(null, Math.round(total * 100) / 100);
            } else {
              var err = new Error("Value not found for " + query);
              console.log(err);
              cb(err);
            }
          } catch(e) {
            console.log("Parse error: ", e);
            cb(e);
          }
      });
  }).on('error', function(e){
        console.log("Got an error: ", e);
        cb(e);
  });
}

//uncomment to test
/*
convertCurrency(10, 'USD', 'PHP', function(err, amount) {
  console.log(amount);
});
*/
            
            self.addEventListener('fetch', function(event) {
	// TODO: respond to all requests with a URL ending in ".jpg" and 404
    
event.respondWith(
fetch(event.request).then(function(response){
    if(response.status == 404){
        return new Response("Whoops, 404 - file not found. And that's all we know (:"));
    }
    return response;
}).catch(function(){
    return new Response("Uh oh, that totally failed! You are offline");
})
);   
    
});
            
https://free.currencyconverterapi.com/api/v5/convert?q=USD_KES
https://free.currencyconverterapi.com/api/v5/convert?q=USD_PHP
https://www.currencyconverterapi.com/docs 
https://www.youtube.com/watch?v=BfL3pprhnms   
            
<!--So what you want to do is if you get a response with `fetch` (meaning you are online) you want to save to IDB. When you do not get a response with `fetch` (you are offline) you want to query IDB. Which is why you need to use IDB in the normal app-->
            
            self.addEventListener('message', function(event) {

    if (event.data.action === 'skipWaiting') {

        self.skipWaiting();

    }

});